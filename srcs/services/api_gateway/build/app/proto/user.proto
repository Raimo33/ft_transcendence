syntax = "proto3";

package user.api_gateway;


service UserAPIGatewayService
{
  rpc RegisterUser                  (RegisterUserRequest)                  returns (RegisterUserResponse) {}
  rpc GetUserProfile                (GetUserProfileRequest)                returns (GetUserProfileResponse) {}
  rpc GetUserStatus                 (GetUserStatusRequest)                 returns (GetUserStatusResponse) {}
  rpc DeleteAccount                 (DeleteAccountRequest)                 returns (DeleteAccountResponse) {}
  rpc GetPrivateProfile             (GetPrivateProfileRequest)             returns (GetPrivateProfileResponse) {}
  rpc UpdateProfile                 (UpdateProfileRequest)                 returns (UpdateProfileResponse) {}
  rpc UpdatePassword                (UpdatePasswordRequest)                returns (UpdatePasswordResponse) {}
  rpc RequestPasswordReset          (RequestPasswordResetRequest)          returns (RequestPasswordResetResponse) {}
  rpc CheckPasswordResetToken       (CheckPasswordResetTokenRequest)       returns (CheckPasswordResetTokenResponse) {}
  rpc ResetPassword                 (ResetPasswordRequest)                 returns (ResetPasswordResponse) {}
  rpc UpdateEmail                   (UpdateEmailRequest)                   returns (UpdateEmailResponse) {}
  rpc CheckEmailVerificationToken   (CheckEmailVerificationTokenRequest)   returns (VerifyEmailResponse) {}
  rpc Enable2FA                     (Enable2FARequest)                     returns (Enable2FAResponse) {}
  rpc Get2FAStatus                  (Get2FAStatusRequest)                  returns (Get2FAStatusResponse) {}
  rpc Disable2FA                    (Disable2FARequest)                    returns (Disable2FAResponse) {}
  rpc Check2FACode                  (Check2FACodeRequest)                  returns (Check2FACodeResponse) {}
  rpc LoginUser                     (LoginUserRequest)                     returns (LoginUserResponse) {}
  rpc LogoutUser                    (LogoutUserRequest)                    returns (LogoutUserResponse) {}
  rpc AddFriend                     (AddFriendRequest)                     returns (AddFriendResponse) {}
  rpc GetFriends                    (GetFriendsRequest)                    returns (GetFriendsResponse) {}
  rpc RemoveFriend                  (RemoveFriendRequest)                  returns (RemoveFriendResponse) {}
}

message UserProfile
{
  required string  id                      = 1;
  required string  display_name            = 2;
  required string  avatar                  = 3;
  required string  status                  = 4;
  required uint64  last_active_timestamp   = 5;
  required uint64  registered_timestamp    = 6;
}
message User
{
  required string  id                      = 1;
  required string  display_name            = 2;
  required string  avatar                  = 3;
  required string  status                  = 4;
  required uint64  last_active_timestamp   = 5;
  required uint64  registered_timestamp    = 6;
  required string  email                   = 7;
  required bool    two_factor_auth_enabled = 8;
}

message ProfileFilters
{
  optional string status = 1;
}

// v1/users POST
message RegisterUserRequest
{
  required string email         = 1;
  required string password      = 2;
  required string display_name  = 3;
  optional string avatar        = 4;
}
message RegisterUserResponse
{
  required uint16  status_code  = 1;
  optional string  user_id      = 2;
}

// v1/users/{user_id}/profile GET
message GetUserProfileRequest
{
  required string requesting_user_id = 1;
  required string user_id            = 2;
  required string etag               = 3;
}
message GetUserProfileResponse
{
  required uint16       status_code = 1;
  optional UserProfile  profile     = 2;
  required string       etag        = 3;
}

// v1/users/{user_id}/status GET
message GetUserStatusRequest
{
  required string  requesting_user_id = 1;
  required string  user_id            = 2;
}
message GetUserStatusResponse
{
  required uint16  status_code = 1;
  optional string  user_status = 2;
}

// v1/user DELETE
message DeleteAccountRequest
{
  required string  requesting_user_id = 1;
}
message DeleteAccountResponse
{
  required uint16  status_code = 1;
}

// v1/user/profile GET
message GetPrivateProfileRequest
{
  required string requesting_user_id  = 1;
  optional string etag                = 2; 
}
message GetPrivateProfileResponse
{
  required uint16  status_code  = 1;
  optional User    profile      = 2;
  required string  etag         = 3;
}

// v1/user/profile PATCH
message UpdateProfileRequest
{
  required string  requesting_user_id = 1;
  optional string  display_name       = 2;
  optional string  avatar             = 3;
}
message UpdateProfileResponse
{
  required uint16  status_code = 1;
}

// v1/user/password PUT
message UpdatePasswordRequest
{
  required string  requesting_user_id  = 1;
  required string  old_password        = 2;
  required string  new_password        = 3;
}
message UpdatePasswordResponse
{
  required uint16  status_code = 1;
}

// v1/user/password/reset POST
message RequestPasswordResetRequest
{
  required string email = 1;
}
message RequestPasswordResetResponse
{
  required uint16  status_code = 1;
}

// v1/user/password/reset/{token} POST
message CheckPasswordResetTokenRequest
{
  required string  token = 1;
}
message CheckPasswordResetTokenResponse
{
  required uint16  status_code = 1;
}

// v1/user/password/reset/{token} PATCH
message ResetPasswordRequest
{
  required string  token         = 1;
  required string  new_password  = 2;
}
message ResetPasswordResponse
{
  required uint16  status_code = 1;
}

// v1/user/email PATCH
message UpdateEmailRequest
{
  required string  requesting_user_id = 1;
  required string  new_email          = 2;
  required string  current_password   = 3;
  optional string  totp_code          = 4;
}
message UpdateEmailResponse
{
  required uint16  status_code = 1;
}

// v1/user/email/verify POST
message VerifyEmailRequest
{
  required string requesting_user_id = 1;
}
message VerifyEmailResponse
{
  required uint16  status_code = 1;
}

// v1/user/email/verify POST
message CheckEmailVerificationTokenRequest
{
  required string  token = 1;
}
message VerifyEmailResponse
{
  required uint16  status_code = 1;
}

// v1/user/2fa POST
message Enable2FARequest
{
  required string  requesting_user_id = 1;
}
message Enable2FAResponse
{
  required uint16 status_code = 1;
  optional string totp_secret = 2;
}

// v1/users/{user_id}/2fa GET
message Get2FAStatusRequest
{
  required string requesting_user_id = 1;
}
message Get2FAStatusResponse
{
  required uint16 status_code             = 1;
  optional bool   two_factor_auth_enabled = 2;
}

// v1/user/2fa DELETE
message Disable2FARequest
{
  required string requesting_user_id = 1;
}
message Disable2FAResponse
{
  required uint16  status_code = 1;
}

// v1/user/2fa/verify POST
message Check2FACodeRequest
{
  required string  requesting_user_id = 1;
  required string  totp_code          = 2;
}
message Check2FACodeResponse
{
  required uint16  status_code = 1;
}

// v1/user/login POST
message LoginUserRequest
{
  required string email     = 1;
  required string password  = 2;
  optional string totp_code = 3;
}
message LoginUserResponse
{
  optional string jwt_token = 2;
}

// v1/user/logout DELETE
message LogoutUserRequest
{
  required string  requesting_user_id = 1;
}
message LogoutUserResponse
{
  required uint16  status_code = 1;
}

// v1/user/friends POST
message AddFriendRequest
{
  required string  requesting_user_id = 1;
  required string  friend_id          = 2;
}
message AddFriendResponse
{
  required uint16  status_code = 1;
}

// v1/user/friends GET
message GetFriendsRequest
{
  required string          requesting_user_id   = 1;
  optional uint32          limit                = 2;
  optional uint32          offset               = 3;
  optional string          sort_by              = 4;
  optional ProfileFilters  filters              = 5;
  optional string          etag                 = 6;
}
message GetFriendsResponse
{
  required uint16           status_code = 1;
  optional repeated string  friend_ids  = 2;
  required string           etag        = 3;
}

// v1/user/friends/{friend_id} DELETE
message RemoveFriendRequest
{
  required string  requesting_user_id  = 1;
  required string  friend_id           = 2;
}
message RemoveFriendResponse
{
  required uint16  status_code = 1;
}