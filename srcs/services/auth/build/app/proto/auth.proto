syntax = "proto3";

package auth;

import "google/protobuf/empty.proto";


service AuthAPIGateway
{
  rpc Ping(google.protobuf.Empty)              returns (google.protobuf.Empty);
  rpc GetJWTPublicKeys(google.protobuf.Empty)  returns (PublicKeys);
}

service AuthUserService
{
  rpc Ping(google.protobuf.Empty)                 returns (google.protobuf.Empty) {}
  rpc CheckDomain(CheckDomainRequest)             returns (google.protobuf.Empty) {}
  rpc HashPassword(HashPasswordRequest)           returns (HashedPassword) {}
  rpc GenerateTFASecret(google.protobuf.Empty)    returns (TFASecret) {}
  rpc CheckTFACode(CheckTFACodeRequest)           returns (google.protobuf.Empty) {}
  rpc GenerateJWT(GenerateJWTRequest)             returns (JWT) {}
}

message PublicKey
{
  required string  id          = 1;
  required string  key         = 2;
  int64            expires_at  = 3;
  bool             is_current  = 4;
}

message PublicKeys
{
  repeated PublicKey  keys = 1;
}

message CheckDomainRequest
{
  string domain = 1;
}

message HashPasswordRequest
{
  string password = 1;
}
message HashedPassword
{
  string hashed_password = 1;
}

message TFASecret
{
  string tfa_secret = 1;
}

message CheckTFACodeRequest
{
  string tfa_secret  = 1;
  string tfa_code    = 2;
}

message GenerateJWTReques
{
  string user_id     = 1;
  uint16 auth_level  = 2;
  bool   pending_tfa = 3;
}
message JWT
{
  string jwt = 1;
}

