# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    API_swagger.yaml                                   :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: craimond <bomboclat@bidol.juis>            +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2024/10/05 19:23:58 by craimond          #+#    #+#              #
#    Updated: 2024/10/06 11:25:11 by craimond         ###   ########.fr        #
#                                                                              #
# **************************************************************************** #

openapi: 3.0.0
info:
  title: Pongfumasters API
  description: REST-ful API to interact with the Pongfumasters gateway.
  version: 1.0.0
servers:
  - url: /api/v1
    description: Main API server
paths:
  /users:
    post:
      #3 per hour
      summary: User registration
      description: Register a new user in the system by providing email, password, and display name.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/User"
      responses:
        "202":
          description: The registration request has been accepted and is being processed asynchronously.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "400":
          description: Bad request due to invalid credentials.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "409":
          description: Conflict, e.g., user with this email already exists.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "429":
          $ref: '#/components/responses/TooManyRequests'
      callbacks:
        registrationCompleted:
          "{$request.body.callbackUrl}":
            post:
              summary: Registration completion callback
              description: Server calls this endpoint when the user registration is complete or failed.
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        status:
                          $ref: "#/components/schemas/async_call_outcome"
                        result:
                          OneOf:
                            - $ref: "#/components/schemas/user_id"
                            - $ref: "#/components/schemas/error_message"
              responses:
                "200":
                  description: Client successfully received the registration result.
    get:
      #150 ogni 10 minuti
      summary: Get a list of users
      description: Retrieve a paginated list of users.
      parameters:
        - name: page
          in: query
          description: Page number of the results to retrieve.
          schema:
            type: integer
            format: int32
            minimum: 1
          required: true
        - name: results_per_page
          in: query
          description: Number of users to retrieve per page.
          schema:
            type: integer
            format: int32
            minimum: 1
          required: true
        - name: sorting_options
          in: query
          description: Sort the users list by display name, email, date registered, last active.
          schema:
            $ref: "#/components/schemas/user_sorting_options"
          required: false
        - name: filter_options
          in: query
          description: Filter the users list by status.
          schema:
            $ref: "#/components/schemas/user_filter_options"
          required: false
        - name: Cache-Control
          in: header
          description: Cache control directives to influence request caching behavior.
          schema:
            type: string
          example: max-age=900, private
          required: false
        - name: If-None-Match
          in: header
          description: ETag header for cache validation. The client can provide the ETag value from a previous request to check if the resource has changed.
          schema:
            type: string
          required: false
      security:
        - jwtAuth: []
      responses:
        "202":
          description: The request has been accepted and is being processed asynchronously.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "304":
          description: Not modified. The resource has not changed since the last request with the given `If-None-Match` value.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "400": 
          description: Bad request due to invalid query parameters.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "429":
          $ref: '#/components/responses/TooManyRequests'
      callbacks:
        usersListReady:
          "{$request.body.callbackUrl}":
            post:
              summary: Users list ready callback
              description: Server calls this endpoint when the users list is ready to be retrieved.
              parameters:
                - name: ETag
                  in: header
                  description: ETag header value representing the version of the data.
                  schema:
                    type: string
                  example: W/"123456789"
                  required: true
                - name: Cache-Control
                  in: header
                  description: Cache control directives for the response.
                  schema:
                    type: string
                  example: private, max-age=900, must-revalidate
                  required: true
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        status:
                          $ref: "#/components/schemas/async_call_outcome"
                        result:
                          OneOf:
                            - type: array
                              items:
                                $ref: "#/components/schemas/User"
                            - $ref: "#/components/schemas/error_message"
              responses:
                "200":
                  description: Client successfully received the users list.
  /users/{user_id}:
    get:
      summary: Get user data by user_id
      description: Retrieve detailed information of a specific user using their unique user_id.
      parameters:
        - name: user_id
          in: path
          description: Unique identifier of the user to retrieve.
          schema:
            $ref: "#/components/schemas/user_id"
          required: true
        - name: Cache-Control
          in: header
          description: Cache control directives to influence request caching behavior.
          schema:
            type: string
          example: no-store
          required: false
        - name: If-None-Match
          in: header
          description: ETag header for cache validation. The client can provide the ETag value from a previous request to check if the resource has changed.
          schema:
            type: string
          required: false
      security:
        - jwtAuth: []
      responses:
        #1 ogni 60 secondi
        "200":
          description: Returns the User object of the specified user.
          headers:
            ETag:
              description: The ETag header value representing the version of the data.
              schema:
                type: string
              example: W/"123456789"
            Cache-Control:
              description: Cache control directives for the response.
              schema:
                type: string
              example: no-store
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "304":
          description: Not modified. The resource has not changed since the last request with the given `If-None-Match` value.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "404":
          description: User not found.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "429":
          $ref: '#/components/responses/TooManyRequests'
    put:
      #2 ogni giorno
      summary: Update user credentials
      description: Update the email, password, or display name of a user using their user_id.
      parameters:
        - name: user_id
          in: path
          description: Unique identifier of the user to update.
          schema:
            $ref: "#/components/schemas/user_id"
          required: true
        - name: If-Match
          in: header
          description: ETag header for optimistic concurrency control. The client can provide the ETag value from a previous request to check if the resource has changed.
          schema:
            type: string
          required: false
      security:
        - jwtAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/User"
      responses:
        "202": 
          description: The request has been accepted and is being processed asynchronously.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "400":
          description: Bad request due to invalid credentials.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "404":
          description: User not found.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "412":
          description: Precondition failed, e.g., ETag mismatch.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "429":
          $ref: '#/components/responses/TooManyRequests'
      callbacks:
        userUpdateCompleted:
          "{$request.body.callbackUrl}":
            post:
              summary: User update completion callback
              description: Server calls this endpoint when the user update is complete or failed.
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        status:
                          $ref: "#/components/schemas/async_call_outcome"
                        error_message:
                          $ref: "#/components/schemas/error_message"
              responses:
                "200":
                  description: Client successfully received the user update result.
    delete:
      #1 al giorno
      summary: Delete a user account
      description: Permanently delete a user account by their user_id.
      parameters:
        - name: user_id
          in: path
          description: Unique identifier of the user to delete.
          schema:
            $ref: "#/components/schemas/user_id"
          required: true
      security:
        - jwtAuth: []
      responses:
        "202":
          description: The deletion request has been accepted and is being processed asynchronously.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "404":
          description: User not found.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "429":
          $ref: '#/components/responses/TooManyRequests'
      callbacks:
        userDeletionCompleted:
          "{$request.body.callbackUrl}":
            post:
              summary: User deletion completion callback
              description: Server calls this endpoint when the user deletion is complete or failed.
              requestBody:
                required: true
                content:
                  application/json:
                    result:
                      AnyOf:
                        status:
                          $ref: "#/components/schemas/async_call_outcome"
                        error_message:
                          $ref: "#/components/schemas/error_message"
              responses:
                "200":
                  description: Client successfully received the user deletion result.
  /user/{user_id}/matches:
    get:
      #10 ogni minuto
      summary: Get list of user matches.
      description: Returns the list of matches a user has ever played in.
      parameters:
        - name: user_id
          in: path
          description: Unique identifier of the user to retrieve data from.
          schema:
            $ref: "#/components/schemas/user_id"
          required: true
        - name: page
          in: query
          description: Page number of the results to retrieve.
          schema:
            type: integer
            format: int32
            minimum: 1
          required: true
        - name: results_per_page
          in: query
          description: Number of matches to retrieve per page.
          schema:
            type: integer
            format: int32
            minimum: 1
          required: true
        - name: sorting_options
          in: query
          description: Sort the matches list by age or duration.
          schema:
            $ref: "#/components/schemas/match_sorting_options"
          required: false
        - name: filter_options
          in: query
          description: Filter the matches list by status or outcome.
          schema:
            $ref: "#/components/schemas/match_filter_options"
          required: false
        - name: Cache-Control
          in: header
          description: Cache control directives to influence caching behavior.
          schema:
            type: string
          example: max-age=300, public, must-revalidate
          required: false
        - name: If-None-Match
          in: header
          description: ETag header for cache validation. The client can provide the ETag value from a previous request to check if the resource has changed.
          schema:
            type: string
          required: false
      security:
        - jwtAuth: []
      responses:
        "202":
          description: The request has been accepted and is being processed asynchronously.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "304":
          description: Not modified. The resource has not changed since the last request with the given `If-None-Match` value.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "400": 
          description: Bad request due to invalid query parameters.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "404":
          description: User not found.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "429":
          $ref: '#/components/responses/TooManyRequests'
      callbacks:
        matchesListReady:
          "{$request.body.callbackUrl}":
            post:
              summary: Matches list ready callback
              description: Server calls this endpoint when the matches list is ready to be retrieved.
              parameters:
                - name: ETag
                  in: header
                  description: ETag header value representing the version of the data.
                  schema:
                    type: string
                  example: W/"123456789"
                  required: true
                - name: Cache-Control
                  in: header
                  description: Cache control directives for the response.
                  schema:
                    type: string
                  example: public, max-age=3600, no-cache
                  required: true
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        status:
                          $ref: "#/components/schemas/async_call_outcome"
                        result:
                          OneOf:
                            - type: array
                              items:
                                $ref: "#/components/schemas/Match"
                            - $ref: "#/components/schemas/error_message"
              responses:
                "200":
                  description: Client successfully received the matches list.

  /user/{user_id}/tournaments:
    get:
      #10 ogni minuto
      summary: Get list of user tournaments.
      description: Returns the list of tournaments a user has ever participated in.
      parameters:
        - name: user_id
          in: path
          description: Unique identifier of the user to retrieve data from.
          schema:
            $ref: "#/components/schemas/user_id"
          required: true
        - name: page
          in: query
          description: Page number of the results to retrieve.
          schema:
            type: integer
            format: int32
            minimum: 1
          required: true
        - name: results_per_page
          in: query
          description: Number of tournaments to retrieve per page.
          schema:
            type: integer
            format: int32
            minimum: 1
          required: true
        - name: sorting_options
          in: query
          description: Sort the tournaments list by age, duration, or number of players.
          schema:
            $ref: "#/components/schemas/tournament_sorting_options"
          required: false
        - name: filter_options
          in: query
          description: Filter the tournaments list by status or mode.
          schema:
            $ref: "#/components/schemas/tournament_filter_options"
          required: false
        - name: Cache-Control
          in: header
          description: Cache control directives to influence caching behavior.
          schema:
            type: string
          example: max-age=300, public, must-revalidate
          required: false
        - name: If-None-Match
          in: header
          description: ETag header for cache validation. The client can provide the ETag value from a previous request to check if the resource has changed.
          schema:
            type: string
          required: false
      security:
        - jwtAuth: []
      responses:
        "202":
          description: The request has been accepted and is being processed asynchronously.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "304":
          description: Not modified. The resource has not changed since the last request with the given `If-None-Match` value.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "400": 
          description: Bad request due to invalid query parameters.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "404":
          description: User not found.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "429":
          $ref: '#/components/responses/TooManyRequests'
      callbacks:
        tournamentsListReady:
          "{$request.body.callbackUrl}":
            post:
              summary: Tournaments list ready callback
              description: Server calls this endpoint when the tournaments list is ready to be retrieved.
              parameters:
                - name: ETag
                  in: header
                  description: ETag header value representing the version of the data.
                  schema:
                    type: string
                  example: W/"123456789"
                  required: true
                - name: Cache-Control
                  in: header
                  description: Cache control directives for the response.
                  schema:
                    type: string
                  example: public, max-age=3600, no-cache
                  required: true
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        status:
                          $ref: "#/components/schemas/async_call_outcome"
                        result:
                          OneOf:
                            - type: array
                              items:
                                $ref: "#/components/schemas/Tournament"
                            - $ref: "#/components/schemas/error_message"
              responses:
                "200":
                  description: Client successfully received the tournaments list.
  /user/{user_id}/friends:
    post:
      #100 al giorno
      summary: Add a friend
      description: Add a user to the friend list.
      parameters:
        - name: user_id
          in: path
          description: Unique identifier of the user adding a friend.
          schema:
            $ref: "#/components/schemas/user_id"
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/user_id"
      security:
        - jwtAuth: []
      responses:
        "202":
          description: The request has been accepted and is being processed asynchronously.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "400":
          description: Bad request due to invalid friend_id.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "404":
          description: User not found.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "429":
          $ref: '#/components/responses/TooManyRequests'
      callbacks:
        friendAdded:
          "{$request.body.callbackUrl}":
            post:
              summary: Friend added callback
              description: Server calls this endpoint when the friend has been added successfully or failed.
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        status:
                          $ref: "#/components/schemas/async_call_outcome"
                        error_message:
                          $ref: "#/components/schemas/error_message"
              responses:
                "200":
                  description: Client successfully received the friend addition result.
    get:
      #15 ogni minuto
      summary: Get list of friends
      description: Retrieve the list of friends of a specific user.
      parameters:
        - name: user_id
          in: path
          description: Unique identifier of the user to retrieve friends from.
          schema:
            $ref: "#/components/schemas/user_id"
          required: true
        - name: page
          in: query
          description: Page number of the results to retrieve.
          schema:
            type: integer
            format: int32
            minimum: 1
          required: true
        - name: results_per_page
          in: query
          description: Number of friends to retrieve per page.
          schema:
            type: integer
            format: int32
            minimum: 1
          required: true
        - name: sorting_options
          in: query
          description: Sort the users list by display name, date registered, last active.
          schema:
            $ref: "#/components/schemas/friends_sorting_options"
          required: false
        - name: filter_options
          in: query
          description: Filter the users list by status.
          schema:
            $ref: "#/components/schemas/friends_filter_options"
          required: false
        - name: Cache-Control
          in: header
          description: Cache control directives to influence caching behavior.
          schema:
            type: string
          example: private, no-cache
          required: false
        - name: If-None-Match
          in: header
          description: ETag header for cache validation. The client can provide the ETag value from a previous request to check if the resource has changed.
          schema:
            type: string
          required: false
      security:
        - jwtAuth: []
      responses:
        "202":
          description: The request has been accepted and is being processed asynchronously.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "304":
          description: Not modified. The resource has not changed since the last request with the given `If-None-Match` value.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "400":
          description: Bad request due to invalid query parameters.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "404":
          description: User not found.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "429":
          $ref: '#/components/responses/TooManyRequests'
      callbacks:
        friendsListReady:
          "{$request.body.callbackUrl}":
            post:
              summary: Friends list ready callback
              description: Server calls this endpoint when the friends list is ready to be retrieved.
              parameters:
                - name: ETag
                  in: header
                  description: ETag header value representing the version of the data.
                  schema:
                    type: string
                  example: W/"123456789"
                  required: true
                - name: Cache-Control
                  in: header
                  description: Cache control directives for the response.
                  schema:
                    type: string
                  example: private, max-age=3600, no-cache
                  required: true
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        status:
                          $ref: "#/components/schemas/async_call_outcome"
                        result:
                          OneOf:
                            - type: array
                              items:
                                $ref: "#/components/schemas/User"
                            - $ref: "#/components/schemas/error_message"
              responses:
                "200":
                  description: Client successfully received the friends list.
  /user/{user_id}/friends/{friend_id}:
    #100 ogni ora
    delete:
      summary: Remove a friend
      description: Remove a user from the friend list.
      parameters:
        - name: user_id
          in: path
          description: Unique identifier of the user removing a friend.
          schema:
            $ref: "#/components/schemas/user_id"
          required: true
        - name: friend_id
          in: path
          description: Unique identifier of the friend to remove.
          schema:
            $ref: "#/components/schemas/user_id"
          required: true
      security:
        - jwtAuth: []
      responses:
        "202":
          description: The request has been accepted and is being processed asynchronously.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "400":
          description: Bad request due to invalid friend_id.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "429":
          $ref: '#/components/responses/TooManyRequests'
      callbacks:
        friendRemoved:
          "{$request.body.callbackUrl}":
            post:
              summary: Friend removed callback
              description: Server calls this endpoint when the friend has been removed successfully or failed.
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      AnyOf:
                        status:
                          $ref: "#/components/schemas/async_call_outcome"
                        error_message:
                          $ref: "#/components/schemas/error_message"
              responses:
                "200":
                  description: Client successfully received the friend removal result.
  /sessions:
    get:
      #10 ogni minuto
      summary: Get login status of all users
      description: Retrieve the login status of all users.
      parameters:
        - name: page
          in: query
          description: Page number of the results to retrieve.
          schema:
            type: integer
            format: int32
            minimum: 1
          required: true
        - name: results_per_page
          in: query
          description: Number of users to retrieve per page.
          schema:
            type: integer
            format: int32
            minimum: 1
          required: true
        - name: filter_options
          in: query
          description: Filter the users list by status.
          schema:
            $ref: "#/components/schemas/user_status"
          required: false
        - name: Cache-Control
          in: header
          description: Cache control directives to influence caching behavior.
          schema:
            type: string
          example: no-cache
          required: false
        - name: If-None-Match
          in: header
          description: ETag header for cache validation. The client can provide the ETag value from a previous request to check if the resource has changed.
          schema:
            type: string
          required: false
      security:
        - jwtAuth: []
      responses:
        "200":
          description: Returns the login status of all users.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
          content:
            application/json:
              schema:
                description: map of user_id to user_status.
                type: object
                additionalProperties:
                  $ref: "#/components/schemas/user_status"
        "304":
          description: Not modified. The resource has not changed since the last request with the given `If-None-Match` value.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "400":
          description: Bad request due to invalid query parameters.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "429":
          $ref: '#/components/responses/TooManyRequests'
    delete:
      #2 al giorno
      summary: Disconnect all users
      description: Logs out all users from the system.
      security:
        - jwtAuth: []
      responses:
        "202":
          description: The request has been accepted and is being processed asynchronously.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "429":
          $ref: '#/components/responses/TooManyRequests'
      callbacks:
        allUsersLoggedOut:
          "{$request.body.callbackUrl}":
            post:
              summary: All users logged out callback
              description: Server calls this endpoint when all users have been logged out successfully or failed.
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        AnyOf:
                          status:
                            $ref: "#/components/schemas/async_call_outcome"
                          error_message:
                            $ref: "#/components/schemas/error_message"
              responses:
                "200":
                  description: Client successfully received the all users logged out result.
  /sessions/{user_id}:
    post:
      #30 ogni ora 
      summary: User login
      description: Authenticate the user and return a JWT token for session management.
      parameters:
        - name: user_id
          in: path
          description: Unique identifier of the user attempting to log in.
          schema:
            $ref: "#/components/schemas/user_id"
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/user_psw"
      responses:
        "202":
          description: The request has been accepted and is being processed asynchronously.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "400":
          description: Bad request due to invalid credentials.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "429":
          $ref: '#/components/responses/TooManyRequests'
      callbacks:
        userLoggedIn:
          "{$request.body.callbackUrl}":
            post:
              summary: User logged in callback
              description: Server calls this endpoint when the user has been logged in successfully or failed.
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        status:
                          $ref: "#/components/schemas/async_call_outcome"
                        result:
                          AnyOf:
                            error_message:
                              $ref: "#/components/schemas/error_message"
                            jwt_token:
                              $ref: "#/components/schemas/jwt_token"
              responses:
                "200":
                  description: Client successfully received the user login result.
    get:
      #10 ogni 60 secondi
      summary: Get user login status
      description: Check if a user is currently logged in and return their status.
      parameters:
        - name: user_id
          in: path
          description: Unique identifier of the user to check.
          schema:
            $ref: "#/components/schemas/user_id"
          required: true
        - name: Cache-Control
          in: header
          description: Cache control directives to influence caching behavior.
          schema:
            type: string
          example: private, max-age=60, must-revalidate
          required: false
        - name: If-None-Match
          in: header
          description: ETag header for cache validation. The client can provide the ETag value from a previous request to check if the resource has changed.
          schema:
            type: string
          required: false
      security:
        - jwtAuth: []
      responses:
        "200":
          description: Returns the login status of the user.
          headers:
            ETag:
              description: The ETag header value representing the version of the data.
              schema:
                type: string
              example: W/"123456789"
            Cache-Control:
              description: Cache control directives for the response.
              schema:
                type: string
              example: private, max-age=3600, no-cache
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/user_status"
        "304":
          description: Not modified. The resource has not changed since the last request with the given `If-None-Match` value.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "404":
          description: User not found.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "429":
          $ref: '#/components/responses/TooManyRequests'
    delete:
      #30 ogni ora
      summary: User logout
      description: Logs out a specific user from the system.
      parameters:
        - name: user_id
          in: path
          description: Unique identifier of the user to log out.
          schema:
            $ref: "#/components/schemas/user_id"
          required: true
      security:
        - jwtAuth: []
      responses:
        "202":
          description: The request has been accepted and is being processed asynchronously.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "429":
          $ref: '#/components/responses/TooManyRequests'
      callbacks:
        userLoggedOut:
          "{$request.body.callbackUrl}":
            post:
              summary: User logged out callback
              description: Server calls this endpoint when the user has been logged out successfully or failed.
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        AnyOf:
                          status:
                            $ref: "#/components/schemas/async_call_outcome"
                          error_message:
                            $ref: "#/components/schemas/error_message"
              responses:
                "200":
                  description: Client successfully received the user logout result.

  /matches:
    post:
      #2 ogni minuto
      summary: Start a new match
      description: Initialize a new Pong match by providing the match settings.
      security:
        - jwtAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MatchSettings"
      responses:
        "202":
          description: The request has been accepted and is being processed asynchronously.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "429":
          $ref: '#/components/responses/TooManyRequests'
      callbacks:
        matchReady:
          "{$request.body.callbackUrl}":
            post:
              summary: Match creation callback
              description: Server calls this endpoint when the match was created successfully or failed.
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        status:
                          $ref: "#/components/schemas/async_call_outcome"
                        result:
                          AnyOf:
                            - $ref: "#/components/schemas/Match"
                            - $ref: "#/components/schemas/error_message"
              responses:
                "200":
                  description: Client successfully received the match creation result.
    delete:
      #2 al giorno
      summary: Interrupt all ongoing matches
      description: Terminate all currently active matches and clear session data.
      security:
        - jwtAuth: []
      responses:
        "202":
          description: The request has been accepted and is being processed asynchronously.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "429":
          $ref: '#/components/responses/TooManyRequests'
      callbacks:
        allMatchesInterrupted:
          "{$request.body.callbackUrl}":
            post:
              summary: All matches interrupted callback
              description: Server calls this endpoint when all matches have been interrupted successfully or failed.
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        AnyOf:
                          status:
                            $ref: "#/components/schemas/async_call_outcome"
                          error_message:
                            $ref: "#/components/schemas/error_message"
              responses:
                "200":
                  description: Client successfully received the all matches interrupted result.
  /matches/{match_id}:
    post:
      #3 al minuto
      summary: Join an ongoing match
      description: Allows a user to join an ongoing match by providing the match ID.
      parameters:
        - name: match_id
          in: path
          description: Unique identifier of the match to join.
          schema:
            $ref: "#/components/schemas/match_id"
          required: true
      security:
        - jwtAuth: []
      responses:
        "202":
          description: The request has been accepted and is being processed asynchronously.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "429":
          $ref: '#/components/responses/TooManyRequests'
      callbacks:
        matchJoined:
          "{$request.body.callbackUrl}":
            post:
              summary: Match joined callback
              description: Server calls this endpoint when the user has joined the match successfully or failed.
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        status:
                          $ref: "#/components/schemas/async_call_outcome"
                        result:
                          AnyOf:
                            - $ref: "#/components/schemas/Match"
                            - $ref: "#/components/schemas/error_message"
              responses:
                "200":
                  description: Client successfully received the match joined result.
    get:
      summary: Get match info
      description: Retrieve details about a specific match using its ID.
      parameters:
        - name: match_id
          in: path
          description: Unique identifier of the match to retrieve information for.
          schema:
            $ref: "#/components/schemas/match_id"
          required: true
        - name: Cache-Control
          in: header
          description: Cache control directives to influence caching behavior.
          schema:
            type: string
          example: no-cache
          required: false
        - name: If-None-Match
          in: header
          description: ETag header for cache validation. The client can provide the ETag value from a previous request to check if the resource has changed.
          schema:
            type: string
          required: false
      responses:
        #5 ogni minuto
        "200":
          description: Returns match information.
          headers:
            ETag:
              description: The ETag header value representing the version of the data.
              schema:
                type: string
              example: W/"123456789"
            Cache-Control:
              description: Cache control directives for the response.
              schema:
                type: string
              #response cache-control depends if the match is ongoing or completed (ongoing: no-cache, public. completed: max-age=31536000, public)
              example: max-age=31536000, public
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Match"
        "304":
          description: Not modified. The resource has not changed since the last request with the given `If-None-Match` value.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "404":
          description: Match not found.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "429":
          $ref: '#/components/responses/TooManyRequests'
    delete:
      #3 al minuto
      summary: Abandon the current match
      description: Exit and terminate the ongoing match.
      parameters:
        - name: match_id
          in: path
          description: Unique identifier of the match to abandon.
          schema:
            $ref: "#/components/schemas/match_id"
          required: true
      security:
        - jwtAuth: []
      responses:
        "202":
          description: The request has been accepted and is being processed asynchronously.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "429":
          $ref: '#/components/responses/TooManyRequests'
      callbacks:
        matchAbandoned:
          "{$request.body.callbackUrl}":
            post:
              summary: Match abandoned callback
              description: Server calls this endpoint when the match has been abandoned successfully or failed.
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        AnyOf:
                          status:
                            $ref: "#/components/schemas/async_call_outcome"
                          error_message:
                            $ref: "#/components/schemas/error_message"
              responses:
                "200":
                  description: Client successfully received the match abandoned result.

  /tournaments:
    post:
      #3 ogni minuto
      summary: Start a new tournament
      description: Initialize a new Pong tournament by providing a list of users to invite and tournament mode.
      security:
        - jwtAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              description: Array of users to invite and mode of the new tournament.
              type: object
              properties:
                players:
                  description: Array of users to invite.
                  type: array
                  items:
                    $ref: "#/components/schemas/User"
                tournament_mode:
                  $ref: "#/components/schemas/tournament_mode"
      responses:
        "202":
          description: The request has been accepted and is being processed asynchronously.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "429":
          $ref: '#/components/responses/TooManyRequests'
      callbacks:
        tournamentReady:
          "{$request.body.callbackUrl}":
            post:
              summary: Tournament creation callback
              description: Server calls this endpoint when the tournament was created successfully or failed.
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        status:
                          $ref: "#/components/schemas/async_call_outcome"
                        result:
                          AnyOf:
                            - $ref: "#/components/schemas/Tournament"
                            - $ref: "#/components/schemas/error_message"
              responses:
                "200":
                  description: Client successfully received the tournament creation result.
    delete:
      #2 al giorno
      summary: Interrupt all ongoing tournaments
      description: Terminate all currently active tournaments and clear session data.
      security:
        - jwtAuth: []
      responses:
        "202":
          description: The request has been accepted and is being processed asynchronously.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "429":
          $ref: '#/components/responses/TooManyRequests'
      callbacks:
        allTournamentsInterrupted:
          "{$request.body.callbackUrl}":
            post:
              summary: All tournaments interrupted callback
              description: Server calls this endpoint when all tournaments have been interrupted successfully or failed.
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        AnyOf:
                          status:
                            $ref: "#/components/schemas/async_call_outcome"
                          error_message:
                            $ref: "#/components/schemas/error_message"
              responses:
                "200":
                  description: Client successfully received the all tournaments interrupted result.
  /tournaments/{tournament_id}:
    post:
      #3 al minuto
      summary: Join an ongoing tournament
      description: Allows an invited user to join an ongoing tournament by providing the tournament ID.
      parameters:
        - name: tournament_id
          in: path
          description: Unique identifier of the tournament to join.
          schema:
            $ref: "#/components/schemas/tournament_id"
          required: true
      security:
        - jwtAuth: []
      responses:
        "202":
          description: The request has been accepted and is being processed asynchronously.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "429":
          $ref: '#/components/responses/TooManyRequests'
      callbacks:
        tournamentJoined:
          "{$request.body.callbackUrl}":
            post:
              summary: Tournament joined callback
              description: Server calls this endpoint when the user has joined the tournament successfully or failed.
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        status:
                          $ref: "#/components/schemas/async_call_outcome"
                        result:
                          AnyOf:
                            - $ref: "#/components/schemas/Tournament"
                            - $ref: "#/components/schemas/error_message"
              responses:
                "200":
                  description: Client successfully received the tournament joined result.
    get:
      summary: Get tournament info
      description: Retrieve details about a specific tournament using its ID.
      parameters:
        - name: tournament_id
          in: path
          description: Unique identifier of the tournament to retrieve information for.
          schema:
            $ref: "#/components/schemas/tournament_id"
          required: true
        - name: Cache-Control
          in: header
          description: Cache control directives to influence caching behavior.
          schema:
            type: string
          example: no-cache
          required: false
        - name: If-None-Match
          in: header
          description: ETag header for cache validation. The client can provide the ETag value from a previous request to check if the resource has changed.
          schema:
            type: string
          required: false
      responses:
        #5 ogni minuto
        "200":
          description: Returns match information.
          headers:
            ETag:
              description: The ETag header value representing the version of the data.
              schema:
                type: string
              example: W/"123456789"
            Cache-Control:
              description: Cache control directives for the response.
              schema:
                type: string
              #response cache-control depends if the tournament is ongoing or completed (ongoing: no-cache, public. completed: max-age=31536000, public)
              example: max-age=31536000, no-cache, public
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Tournament"
        "401":
          $ref: '#/components/responses/Unauthorized'
        "404":
          description: Tournament not found.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "429":
          $ref: '#/components/responses/TooManyRequests'
    patch:
      #3 al minuto
      summary: Force start a tournament
      description: Force start the tournament (even if not all players have accepted the invitation).
      parameters:
        - name: tournament_id
          in: path
          description: Unique identifier of the tournament to start.
          schema:
            $ref: "#/components/schemas/tournament_id"
          required: true
      security:
        - jwtAuth: []
      responses:
        "202":
          description: The request has been accepted and is being processed asynchronously.
          headers:
            X-Rate-Limit-Limit:
              $ref: '#/components/headers/X-Rate-Limit-Limit'
            X-Rate-Limit-Remaining:
              $ref: '#/components/headers/X-Rate-Limit-Remaining'
            X-Rate-Limit-Reset:
              $ref: '#/components/headers/X-Rate-Limit-Reset'
            X-Rate-Limit-Interval:
              $ref: '#/components/headers/X-Rate-Limit-Interval'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "429":
          $ref: '#/components/responses/TooManyRequests'
      callbacks:
        tournamentStarted:
          "{$request.body.callbackUrl}":
            post:
              summary: Tournament started callback
              description: Server calls this endpoint when the tournament has been started successfully or failed.
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        AnyOf:
                          status:
                            $ref: "#/components/schemas/async_call_outcome"
                          error_message:
                            $ref: "#/components/schemas/error_message"
              responses:
                "200":
                  description: Client successfully received the tournament started result.
    delete:
      #3 al minuto
      summary: Abandon the specified tournament
      description: Exit and resign from the ongoing tournament.
      parameters:
        - name: tournament_id
          in: path
          description: Unique identifier of the tournament to abandon.
          schema:
            $ref: "#/components/schemas/tournament_id"
          required: true
      security:
        - jwtAuth: []
      responses:
        "401":
          $ref: '#/components/responses/Unauthorized'
        "429":
          $ref: '#/components/responses/TooManyRequests'
      callbacks:
        tournamentAbandoned:
          "{$request.body.callbackUrl}":
            post:
              summary: Tournament abandoned callback
              description: Server calls this endpoint when the tournament has been abandoned successfully or failed.
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        AnyOf:
                          status:
                            $ref: "#/components/schemas/async_call_outcome"
                          error_message:
                            $ref: "#/components/schemas/error_message"
              responses:
                "200":
                  description: Client successfully received the tournament abandoned result.

components:
  schemas:

    user_id:
      description: Unique identifier for the user (or AI bot) (UUID format or similar).
      type: string
    user_psw:
      description: User's password (plain-text) for authentication.
      type: string
    user_email:
      description: User's email address, used for login and notifications.
      type: string
    user_display_name:
      description: Display name of the user, visible to other players during gameplay.
      type: string
    user_avatar:
      description: User's avatar image, used for profile picture, defaults to a generic avatar if not provided.
      oneOf:
        - type: string
          description: URL to the user's avatar image.
        - type: string
          description: Base64-encoded image data for the user's avatar.
    user_status:
      description: Current status of the user (online or offline).
      type: string
      enum: [online, offline]
      example: online

    jwt_token:
      description: JWT token for session management.
      type: string

    websocket_url:
      description: WebSocket URL for real-time interaction during the match. Used by clients to establish connections and interact with the game in real-time.
      type: string

    match_id:
      description: Unique identifier for the match (UUID format or similar).
      type: string
    match_status:
      description: Current status of the match.
      type: string
      enum: [ongoing, completed, interrupted]
    match_ball_speed:
      description: Defines the speed of the ball in the match.
      type: integer
      format: int32
      minimum: 1
      maximum: 100
    match_max_duration:
      description: Maximum allowable duration (seconds) for the match.
      type: integer
      format: int32
      minimum: 60
      maximum: 3600
    match_starting_health_points:
      description: Initial health or lives given to each player at the start of the match.
      type: integer
      format: int32
      minimum: 1
      maximum: 100
    match_outcome:
      description: Outcome of the match (win, loss, draw).
      type: string
      enum: [win, loss, draw]

    player_health_points:
      description: Current health points of the player.
      type: integer
      format: int32
      minimum: 0
      maximum: 100

    tournament_id:
      description: Unique identifier for the tournament (UUID format or similar).
      type: string
    tournament_mode:
      description: Format of the tournament.
      type: string
      enum: [knockout, king_of_the_hill, ladder, round_robin]
    tournament_status:
      description: Current status of the tournament.
      type: string
      enum: [ongoing, completed, interrupted]

    date:
      description: Date and time in unix timestamp format.
      type: integer
      format: int64

    User:
      type: object
      description: Represents a user (or an AI bot) in the Pongmasters system.
      properties:
        user_id:
          $ref: "#/components/schemas/user_id"
        email:
          $ref: "#/components/schemas/user_email"      
        display_name:
          $ref: "#/components/schemas/user_display_name"
        avatar:
          $ref: "#/components/schemas/user_avatar"
        status:
          $ref: "#/components/schemas/user_status"
      required:
        - user_id

    MatchSettings:
      type: object
      description: Settings and configurations for the match, such as ball speed, match duration, and player health.
      properties:
        ball_speed:
          $ref: "#/components/schemas/match_ball_speed"
        max_duration:
          $ref: "#/components/schemas/match_max_duration"
        starting_health:
          $ref: "#/components/schemas/match_starting_health_points"

    Match:
      type: object
      description: Represents a Pong match, including players information, settings, and WebSocket connection details.
      properties:
        match_id:
          $ref: "#/components/schemas/match_id"
        websocket_url:
          $ref: "#/components/schemas/websocket_url"
        players:
          type: array
          description: Array of the players in the match.
          items:
            $ref: "#/components/schemas/User"
        healths:
          type: object
          description: A map of user IDs to their respective health points in the match.
          additionalProperties:
            $ref: "#/components/schemas/player_health_points"
        status:
          $ref: "#/components/schemas/match_status"
        date_started:
          $ref: "#/components/schemas/date"
        date_finished:
          $ref: "#/components/schemas/date"
        match_settings:
          $ref: "#/components/schemas/MatchSettings"
      required:
        - match_id

    Tournament:
      type: object
      description: Represents a Pong tournament, including matches information and mode.
      properties:
        tournament_id:
          $ref: "#/components/schemas/tournament_id"
        tournament_mode:
          $ref: "#/components/schemas/tournament_mode"
        matches:
          type: array
          description: Array of all the tournament matches.
          items:
            $ref: "#/components/schemas/Match"
        status:
          $ref: "#/components/schemas/tournament_status"
        date_started:
          $ref: "#/components/schemas/date"
        date_finished:
          $ref: "#/components/schemas/date"
      required:
        - tournament_id

    user_sorting_options:
      description: Options to sort the users list.
      type: string
      enum: [display_name, email, date_registered, last_active]
      example: display_name

    user_filter_options:
      description: Options to filter the users list.
      type: object
      properties:
        status:
          $ref: "#/components/schemas/user_status"

    friends_sorting_options:
      description: Options to sort the friends list.
      type: string
      enum: [display_name, date_registered, last_active]
      example: display_name

    friends_filter_options:
      description: Options to filter the friends list.
      type: object
      properties:
        status:
          $ref: "#/components/schemas/user_status"

    match_sorting_options:
      description: Options to sort the matches list.
      type: string
      enum: [age, duration]
      example: age

    match_filter_options:
      description: Options to filter the matches list.
      type: object
      properties:
        status:
          $ref: "#/components/schemas/match_status"
        outcome:
          $ref: "#/components/schemas/match_outcome"

    tournament_sorting_options:
      description: Options to sort the tournaments list.
      type: string
      enum: [age, duration, number_of_players]
      example: start_date
    
    tournament_filter_options:
      description: Options to filter the tournaments list.
      type: object
      properties:
        status:
          $ref: "#/components/schemas/tournament_status"
        mode:
          $ref: "#/components/schemas/tournament_mode"
    
    error_message:
      description: Error message returned by the API.
      type: string
    
    async_call_outcome:
      description: Outcome of an asynchronous call.
      type: string
      enum: [success, failure]
      example: success
  
  headers:
    X-Rate-Limit-Limit:
      description: Maximum number of requests allowed in the current window.
      schema:
        type: integer
        format: int32
        minimum: 1
      example: 100

    X-Rate-Limit-Remaining:
      description: Remaining number of requests allowed in the current window.
      schema:
        type: integer
        format: int32
        minimum: 0
      example: 99

    X-Rate-Limit-Reset:
      description: Time in seconds until the rate limit resets.
      schema:
        type: integer
        format: int32
        minimum: 0
      example: 60

    X-Rate-Limit-Interval:
      description: Time interval in seconds for the rate limit window.
      schema:
        type: integer
        format: int32
        minimum: 1
      example: 60
  
    Retry-After:
      description: Time in seconds until the client can retry the request.
      schema:
        type: integer
        format: int32
        minimum: 0
      example: 60
  
  responses:

    TooManyRequests:
      description: Rate limit exceeded. Too many requests in a given time window.
      headers:
        X-Rate-Limit-Limit:
          $ref: '#/components/headers/X-Rate-Limit-Limit'
        X-Rate-Limit-Reset:
          $ref: '#/components/headers/X-Rate-Limit-Reset'
        X-Rate-Limit-Interval:
          $ref: '#/components/headers/X-Rate-Limit-Interval'
        Retry-After:
          $ref: '#/components/headers/Retry-After'

    Unauthorized:
      description: Unauthorized. JWT token is missing or invalid.
      headers:
        X-Rate-Limit-Limit:
          $ref: '#/components/headers/X-Rate-Limit-Limit'
        X-Rate-Limit-Remaining:
          $ref: '#/components/headers/X-Rate-Limit-Remaining'
        X-Rate-Limit-Reset:
          $ref: '#/components/headers/X-Rate-Limit-Reset'
        X-Rate-Limit-Interval:
          $ref: '#/components/headers/X-Rate-Limit-Interval'

  securitySchemes:
    jwtAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT used for authorization. Send the token in the `Authorization` header with the format `Bearer {token}`.

security:
  - jwtAuth: []