openapi: 3.0.0
info:
  title: Pongmasters API
  description: REST-ful API to interact with the Pongmasters gateway.
  version: 1.0.0
servers:
  - url: /api/v1
    description: Main API server
paths:
  /users:
    post:
      summary: User registration
      description: Register a new user in the system by providing email, password, and display name.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserCredentials"
          application/xml:
            schema:
              $ref: "#/components/schemas/UserCredentials"
      responses:
        "200":
          description: Returns the user ID upon successful registration.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/user_id"
            application/xml:
              schema:
                $ref: "#/components/schemas/user_id"
        "400":
          description: Bad request due to invalid input data.
        "409":
          description: Conflict, e.g., user with this email already exists.
    get:
      summary: Get a list of users
      description: Retrieve a paginated list of users.
      parameters:
        - name: page
          in: query
          description: Page number of the results to retrieve.
          schema:
            type: integer
            format: int32
            minimum: 1
        - name: results_per_page
          in: query
          description: Number of users to retrieve per page.
          schema:
            type: integer
            format: int32
            minimum: 1
      security:
        - jwtAuth: []
      responses:
        "200":
          description: Returns an array of User objects.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"
            application/xml:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"
        "401":
          description: Unauthorized access, JWT token is missing or invalid.
  /users/{user_id}:
    get:
      summary: Get user data by user_id
      description: Retrieve detailed information of a specific user using their unique user_id.
      parameters:
        - name: user_id
          in: path
          required: true
          description: Unique identifier of the user to retrieve.
          schema:
            $ref: "#/components/schemas/user_id"
      security:
        - jwtAuth: []
      responses:
        "200":
          description: Returns the User object of the specified user.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
            application/xml:
              schema:
                $ref: "#/components/schemas/User"
        "404":
          description: User not found.
        "401":
          description: Unauthorized access, JWT token is missing or invalid.
    put:
      summary: Update user credentials
      description: Update the email, password, or display name of a user using their user_id.
      parameters:
        - name: user_id
          in: path
          required: true
          description: Unique identifier of the user to update.
          schema:
            $ref: "#/components/schemas/user_id"
      security:
        - jwtAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserCredentials"
          application/xml:
            schema:
              $ref: "#/components/schemas/UserCredentials"
      responses:
        "200":
          description: User data updated successfully.
        "400":
          description: Bad request due to invalid input data.
        "404":
          description: User not found.
        "401":
          description: Unauthorized access, JWT token is missing or invalid.
    delete:
      summary: Delete a user account
      description: Permanently delete a user account by their user_id.
      parameters:
        - name: user_id
          in: path
          required: true
          description: Unique identifier of the user to delete.
          schema:
            $ref: "#/components/schemas/user_id"
      security:
        - jwtAuth: []
      responses:
        "204":
          description: User account deleted successfully.
        "404":
          description: User not found.
        "401":
          description: Unauthorized access, JWT token is missing or invalid.
  /user/{user_id}/matches:
    get:
      summary: Get list of user matches.
      description: Returns the list of matches a user has ever played in.
      parameters:
        - name: user_id
          in: path
          required: true
          description: Unique identifier of the user to retrieve data from.
          schema:
            $ref: "#/components/schemas/user_id"
        - name: page
          in: query
          description: Page number of the results to retrieve.
          schema:
            type: integer
            format: int32
            minimum: 1
        - name: results_per_page
          in: query
          description: Number of matches to retrieve per page.
          schema:
            type: integer
            format: int32
            minimum: 1
      security:
        - jwtAuth: []
      responses:
        "200":
          description: Returns an array of matches.
          content:
            application/json:
              schema:
                description: Array of matches the user played in.
                type: array
                items:
                  $ref: "#/components/schemas/Match"
            application/xml:
              schema:
                description: Array of matches the user played in.
                type: array
                items:
                  $ref: "#/components/schemas/Match"
        "404":
          description: User not found.
        "401":
          description: Unauthorized access, JWT token is missing or invalid.
  
  /sessions:
    get:
      summary: Get login status of all users
      description: Retrieve the login status of all users.
      security:
        - jwtAuth: []
      responses:
        "200":
          description: Returns a map of user_ids and their respective statuses.
          content:
            application/json:
              schema:
                description: a map of user_ids and their respective status.
                type: object
                additionalProperties:
                  $ref: "#/components/schemas/user_status"
            application/xml:
              schema:
                description: a map of user IDs and their respective status.
                type: object
                additionalProperties:
                  $ref: "#/components/schemas/user_status"
        "401":
          description: Unauthorized access, JWT token is missing or invalid.
    delete:
      summary: Disconnect all users
      description: Logs out all users from the system.
      security:
        - jwtAuth: []
      responses:
        "204":
          description: All users successfully logged out.
        "401":
          description: Unauthorized access, JWT token is missing or invalid.
  /sessions/{user_id}:
    post:
      summary: User login
      description: Authenticate the user and return a JWT token for session management.
      parameters:
        - name: user_id
          in: path
          required: true
          description: Unique identifier of the user attempting to log in.
          schema:
            $ref: "#/components/schemas/user_id"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/user_psw"
          application/xml:
            schema:
              $ref: "#/components/schemas/user_psw"
      responses:
        "200":
          description: Returns a JWT token upon successful authentication.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/jwt_token"
            application/xml:
              schema:
                $ref: "#/components/schemas/jwt_token"
        "400":
          description: Bad request due to invalid credentials.
        "404":
          description: User not found.
    get:
      summary: Get user login status
      description: Check if a user is currently logged in and return their status.
      parameters:
        - name: user_id
          in: path
          required: true
          description: Unique identifier of the user to check.
          schema:
            $ref: "#/components/schemas/user_id"
      security:
        - jwtAuth: []
      responses:
        "200":
          description: Returns the login status of the user.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/user_status"
            application/xml:
              schema:
                $ref: "#/components/schemas/user_status"
        "404":
          description: User not found.
        "401":
          description: Unauthorized access, JWT token is missing or invalid.
    delete:
      summary: User logout
      description: Logs out a specific user from the system.
      parameters:
        - name: user_id
          in: path
          required: true
          description: Unique identifier of the user to log out.
          schema:
            $ref: "#/components/schemas/user_id"
      security:
        - jwtAuth: []
      responses:
        "204":
          description: User successfully logged out.
        "404":
          description: User not found.
        "401":
          description: Unauthorized access, JWT token is missing or invalid.

  /matches:
    post:
      summary: Start a new match
      description: Initialize a new Pong match by providing the match settings.
      security:
        - jwtAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MatchSettings"
          application/xml:
            schema:
              $ref: "#/components/schemas/MatchSettings"
      responses:
        "200":
          description: Returns a Match object, including the WebSocket URL for real-time communication during the game.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Match"
            application/xml:
              schema:
                $ref: "#/components/schemas/Match"
        "400":
          description: Bad request due to invalid match settings.
        "401":
          description: Unauthorized access, JWT token is missing or invalid.
        "409":
          description: Conflict, e.g., match already in progress.
    delete:
      summary: Interrupt all ongoing matches
      description: Terminate all currently active matches and clear session data.
      security:
        - jwtAuth: []
      responses:
        "204":
          description: All matches interrupted successfully.
        "401":
          description: Unauthorized access, JWT token is missing or invalid.
  /matches/{match_id}:
    post:
      summary: Join an ongoing match
      description: Allows a user to join an ongoing match by providing the match ID.
      parameters:
        - name: match_id
          in: path
          required: true
          description: Unique identifier of the match to join.
          schema:
            $ref: "#/components/schemas/match_id"
      security:
        - jwtAuth: []
      responses:
        "200":
          description: Successfully joined the match.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Match"
            application/xml:
              schema:
                $ref: "#/components/schemas/Match"
        "404":
          description: Match not found.
        "401":
          description: Unauthorized access, JWT token is missing or invalid.
    get:
      summary: Get info on an ongoing match
      description: Retrieve details about a specific ongoing match using its ID.
      parameters:
        - name: match_id
          in: path
          required: true
          description: Unique identifier of the match to retrieve information for.
          schema:
            $ref: "#/components/schemas/match_id"
      responses:
        "200":
          description: Returns match information.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Match"
            application/xml:
              schema:
                $ref: "#/components/schemas/Match"
        "404":
          description: Match not found.
        "401":
          description: Unauthorized access, JWT token is missing or invalid.
    delete:
      summary: Abandon the current match
      description: Exit and terminate the ongoing match.
      parameters:
        - name: match_id
          in: path
          required: true
          description: Unique identifier of the match to abandon.
          schema:
            $ref: "#/components/schemas/match_id"
      security:
        - jwtAuth: []
      responses:
        "204":
          description: Match abandoned successfully.
        "404":
          description: Match not found.
        "401":
          description: Unauthorized access, JWT token is missing or invalid.
  
  /tournaments:
    post:
      summary: Start a new tournament
      description: Initialize a new Pong tournament by providing a list of users to invite and tournament mode.
      security:
        - jwtAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              description: Array of users to invite and mode of the new tournament.
              type: object
              properties:
                players:
                  description: Array of users to invite.
                  type: array
                  items:
                    $ref: "#/components/schemas/User"
                tournament_mode:
                  $ref: "#/components/schemas/tournament_mode"
          application/xml:
            schema:
              description: Array of users to invite and mode of the new tournament.
              type: object
              properties:
                players:
                  description: Array of users to invite.
                  type: array
                  items:
                    $ref: "#/components/schemas/User"
                tournament_mode:
                  $ref: "#/components/schemas/tournament_mode"
      responses:
        "200":
          description: Returns a Tournament object, including details of each match.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Tournament"
            application/xml:
              schema:
                $ref: "#/components/schemas/Tournament"
        "400":
          description: Bad request due to invalid invited user.
        "401":
          description: Unauthorized access, JWT token is missing or invalid.
        "409":
          description: Conflict, e.g., too many tournaments in progress.
    delete:
      summary: Interrupt all ongoing tournaments
      description: Terminate all currently active tournaments and clear session data.
      security:
        - jwtAuth: []
      responses:
        "204":
          description: All tournaments interrupted successfully.
        "401":
          description: Unauthorized access, JWT token is missing or invalid.
  /tournaments/{tournament_id}:
    post:
      summary: Join an ongoing tournament
      description: Allows an invited user to join an ongoing tournament by providing the tournament ID.
      parameters:
        - name: tournament_id
          in: path
          required: true
          description: Unique identifier of the tournament to join.
          schema:
            $ref: "#/components/schemas/tournament_id"
      security:
        - jwtAuth: []
      responses:
        "200":
          description: Successfully joined the tournament.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Tournament"
            application/xml:
              schema:
                $ref: "#/components/schemas/Tournament"
        "404":
          description: Tournament not found.
        "401":
          description: Unauthorized access, JWT token is missing or invalid.
    get:
      summary: Get info on an ongoing tournament
      description: Retrieve details about a specific ongoing tournament using its ID.
      parameters:
        - name: tournament_id
          in: path
          required: true
          description: Unique identifier of the tournament to retrieve information for.
          schema:
            $ref: "#/components/schemas/tournament_id"
      responses:
        "200":
          description: Returns match information.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Tournament"
            application/xml:
              schema:
                $ref: "#/components/schemas/Tournament"
        "404":
          description: Tournament not found.
        "401":
          description: Unauthorized access, JWT token is missing or invalid.
    delete:
      summary: Abandon the specified tournament
      description: Exit and resign from the ongoing tournament.
      parameters:
        - name: tournament_id
          in: path
          required: true
          description: Unique identifier of the tournament to abandon.
          schema:
            $ref: "#/components/schemas/tournament_id"
      security:
        - jwtAuth: []
      responses:
        "204":
          description: Tournament abandoned successfully.
        "404":
          description: Tournament not found.
        "401":
          description: Unauthorized access, JWT token is missing or invalid.

components:
  schemas:

    user_id:
      description: Unique identifier for the user (or AI bot) (UUID format or similar).
      type: string
    user_psw:
      description: User's password (plain-text) for authentication.
      type: string
    user_email:
      description: User's email address, used for login and notifications.
      type: string
    user_display_name:
      description: Display name of the user, visible to other players during gameplay.
      type: string
    user_status:
      description: Current status of the user (online or offline).
      type: string
      enum: [online, offline]
      example: online
    jwt_token:
      description: JWT token for session management.
      type: string
    websocket_url:
      description: WebSocket URL for real-time interaction during the match. Used by clients to establish connections and interact with the game in real-time.
      type: string
    match_id:
      description: Unique identifier for the match (UUID format or similar).
      type: string
    match_status:
      description: Current status of the match.
      type: string
      enum: [ongoing, completed, interrupted]
    match_ball_speed:
      description: Defines the speed of the ball in the match.
      type: integer
      format: int32
      minimum: 1
      maximum: 100
    match_max_duration:
      description: Maximum allowable duration (seconds) for the match.
      type: integer
      format: int32
      minimum: 60
      maximum: 3600
    match_starting_health_points:
      description: Initial health or lives given to each player at the start of the match.
      type: integer
      format: int32
      minimum: 1
      maximum: 100
    player_health_points:
      description: Current health points of the player.
      type: integer
      format: int32
      minimum: 0
      maximum: 100
    tournament_id:
      description: Unique identifier for the tournament (UUID format or similar).
      type: string
    tournament_mode:
      description: Format of the tournament.
      type: string
      enum: [knockout, king_of_the_hill, ladder, round_robin]
    tournament_status:
      description: Current status of the tournament.
      type: string
      enum: [ongoing, completed, interrupted]

    UserCredentials:
      type: object
      description: Represents the credentials used for user registration or login.
      properties:
        email:
          $ref: "#/components/schemas/user_email"
        psw:
          $ref: "#/components/schemas/user_psw"
        display_name:
          $ref: "#/components/schemas/user_display_name"
      xml:
        name: UserCredentials

    User:
      type: object
      description: Represents a user (or an AI bot) in the Pongmasters system.
      properties:
        user_id:
          $ref: "#/components/schemas/user_id"
        email:
          $ref: "#/components/schemas/user_email"      
        display_name:
          $ref: "#/components/schemas/user_display_name"
        status:
          $ref: "#/components/schemas/user_status"
      required:
        - user_id
      xml:
        name: User
    
    MatchSettings:
      type: object
      description: Settings and configurations for the match, such as ball speed, match duration, and player health.
      properties:
        ball_speed:
          $ref: "#/components/schemas/match_ball_speed"
        max_duration:
          $ref: "#/components/schemas/match_max_duration"
        starting_health:
          $ref: "#/components/schemas/match_starting_health"
      xml:
        name: MatchSettings

    Match:
      type: object
      description: Represents a Pong match, including players information, settings, and WebSocket connection details.
      properties:
        match_id:
          $ref: "#/components/schemas/match_id"
        websocket_url:
          $ref: "#/components/schemas/websocket_url"
        players:
          type: array
          description: Array of the players in the match.
          items:
            $ref: "#/components/schemas/User"
        healths:
          type: object
          description: A map of user IDs to their respective health points in the match.
          additionalProperties:
            $ref: "#/components/schemas/player_health_points"
        status:
          $ref: "#/components/schemas/match_status"
        match_settings:
          $ref: "#/components/schemas/MatchSettings"
      required:
        - match_id
      xml:
        name: Match

    Tournament:
      type: object
      description: Represents a Pong tournament, including matches information and mode.
      properties:
        tournament_id:
          $ref: "#/components/schemas/tournament_id"
        tournament_mode:
          $ref: "#/components/schemas/tournament_mode"
        matches:
          type: array
          description: Array of all the tournament matches.
          items:
            $ref: "#/components/schemas/Match"
        status:
          $ref: "#/components/schemas/tournament_status"
      required:
        - tournament_id
      xml:
        name: Tournament

  securitySchemes:
    jwtAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT used for authorization. Send the token in the `Authorization` header with the format `Bearer {token}`.

security:
  - jwtAuth: []